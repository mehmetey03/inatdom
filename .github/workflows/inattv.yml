name: Inattv Domain Check

on:
  schedule:
    - cron: "*/30 * * * *"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  check-domain:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install deps
        run: pip install requests

      - name: Check and update domain
        run: |
          if [ -f domain.txt ]; then
            CURRENT_DOMAIN=$(cut -d'=' -f2 domain.txt)
          else
            CURRENT_DOMAIN="https://inattv1217.xyz/"
            echo "guncel_domain=$CURRENT_DOMAIN" > domain.txt
          fi

          if echo "$CURRENT_DOMAIN" | grep -q 'inattv[0-9]\+'; then
            DOMAIN_NUMBER=$(echo "$CURRENT_DOMAIN" | grep -o 'inattv[0-9]\+' | grep -o '[0-9]\+')
          else
            DOMAIN_NUMBER="1217"
          fi

          python3 -c "import requests,re,sys
headers={'User-Agent':'Mozilla/5.0'}
def ok(u):
    try:
        r=requests.get(u,timeout=8,headers=headers)
        return r.status_code==200 and 'tv' in r.text.lower()
    except:
        return False

current='$CURRENT_DOMAIN'
start=int('$DOMAIN_NUMBER')
working=None

if ok(current):
    working=current
else:
    for i in range(15):
        d=f'https://inattv{start+i}.xyz/'
        if ok(d):
            working=d
            break

if not working:
    working='https://inattv1217.xyz/'

open('domain.txt','w').write(f'guncel_domain={working}')
print('GÃ¼ncel domain:',working)
"

      - name: Commit changes
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add domain.txt
          git diff --staged --quiet || git commit -m "Update domain" && git push
